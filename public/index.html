<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POS - Papeler√≠a Gran Avenida</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f0f2f5;
            color: #333;
        }

        .header {
            background: linear-gradient(135deg, #B70000 0%, #B70000 100%);
            color: white;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 5px;
        }

        .header p {
            opacity: 0.9;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            background: white;
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .tab {
            padding: 12px 24px;
            background: #f8f9fa;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
            font-weight: 500;
        }

        .tab:hover {
            background: #e9ecef;
        }

        .tab.active {
            background: linear-gradient(135deg, #B70000 0%, #B70000 100%);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }

        .card h2 {
            margin-bottom: 20px;
            color: #B70000;
            font-size: 24px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #B70000 0%, #B70000 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .stat-card h3 {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .stat-card .value {
            font-size: 32px;
            font-weight: bold;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }

        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #495057;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #B70000;
            color: white;
        }

        .btn-primary:hover {
            background: #B70000;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #495057;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-size: 14px;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .producto-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 10px;
            transition: all 0.3s;
        }

        .producto-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }

        .carrito {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            position: sticky;
            top: 20px;
        }

        .carrito-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .total {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid #667eea;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            animation: slideDown 0.3s;
        }

        @keyframes slideDown {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .close {
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #adb5bd;
        }

        .close:hover {
            color: #495057;
        }

        .alert {
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }

        .venta-layout {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
        }

        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }

        .badge-danger {
            background: #fee;
            color: #dc3545;
        }

        .badge-success {
            background: #d4edda;
            color: #28a745;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Papeler√≠a Gran Avenida</h1>
        <p>Sistema de Gesti√≥n de Ventas</p>
    </div>

    <div class="container">
        <div class="tabs">
            <button class="tab active" onclick="showTab('dashboard')">Inicio</button>
            <button class="tab" onclick="showTab('venta')">Nueva Venta</button>
            <button class="tab" onclick="showTab('productos')">Productos</button>
            <button class="tab" onclick="showTab('historial')">Historial</button>
        </div>

        <!-- DASHBOARD -->
        <div id="dashboard" class="tab-content active">
            <div class="grid">
                <div class="stat-card">
                    <h3>Total Ventas</h3>
                    <div class="value" id="totalVentas">$0</div>
                </div>
                <div class="stat-card">
                    <h3>Ventas Hoy</h3>
                    <div class="value" id="ventasHoy">0</div>
                </div>
                <div class="stat-card">
                    <h3>Promedio por Venta</h3>
                    <div class="value" id="promedioVenta">$0</div>
                </div>
                <div class="stat-card">
                    <h3>Total Productos</h3>
                    <div class="value" id="totalProductos">0</div>
                </div>
            </div>

            <div class="card">
                <h2>üìà Productos M√°s Vendidos</h2>
                <table id="topProductos">
                    <thead>
                        <tr>
                            <th>Producto</th>
                            <th>Cantidad Vendida</th>
                            <th>Precio</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>

            <div class="card">
                <h2>‚ö†Ô∏è Productos con Stock Bajo</h2>
                <table id="stockBajo">
                    <thead>
                        <tr>
                            <th>Producto</th>
                            <th>Stock Actual</th>
                            <th>Precio</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- NUEVA VENTA -->
        <div id="venta" class="tab-content">
            <div class="venta-layout">
                <div>
                    <div class="card">
                        <h2>Productos Disponibles</h2>
                        <input type="text" id="buscarProducto" placeholder="üîç Buscar producto..." style="width: 100%; padding: 10px; margin-bottom: 15px; border: 1px solid #ced4da; border-radius: 6px;">
                        <div id="listaProductosVenta"></div>
                    </div>
                </div>

                <div class="carrito">
                    <h2 style="color: #667eea; margin-bottom: 20px;">üõí Carrito</h2>
                    <div id="carritoItems"></div>
                    <div class="total">Total: $<span id="totalCarrito">0</span></div>
                    <div class="form-group" style="margin-top: 20px;">
                        <label>M√©todo de Pago</label>
                        <select id="metodoPago">
                            <option>Efectivo</option>
                            <option>Tarjeta</option>
                            <option>Transferencia</option>
                        </select>
                    </div>
                    <button class="btn btn-success" style="width: 100%; margin-top: 15px; padding: 15px;" onclick="procesarVenta()">üí≥ Procesar Venta</button>
                    <button class="btn btn-danger" style="width: 100%; margin-top: 10px;" onclick="limpiarCarrito()">üóëÔ∏è Limpiar</button>
                </div>
            </div>
        </div>

        <!-- PRODUCTOS -->
        <div id="productos" class="tab-content">
            <div class="card">
                <h2>Gesti√≥n de Productos</h2>
                <button class="btn btn-primary" onclick="mostrarModalProducto()">‚ûï Nuevo Producto</button>
                <table id="tablaProductos">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Nombre</th>
                            <th>Precio</th>
                            <th>Stock</th>
                            <th>Categor√≠a</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- HISTORIAL -->
        <div id="historial" class="tab-content">
            <div class="card">
                <h2>Historial de Ventas</h2>
                <table id="tablaHistorial">
                    <thead>
                        <tr>
                            <th>Factura</th>
                            <th>Fecha</th>
                            <th>Items</th>
                            <th>Total</th>
                            <th>M√©todo Pago</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Modal Producto -->
    <div id="modalProducto" class="modal">
        <div class="modal-content">
            <span class="close" onclick="cerrarModalProducto()">&times;</span>
            <h2 id="tituloModal">Nuevo Producto</h2>
            <form id="formProducto" onsubmit="guardarProducto(event)">
                <input type="hidden" id="productoId">
                <div class="form-group">
                    <label>Nombre</label>
                    <input type="text" id="productoNombre" required>
                </div>
                <div class="form-group">
                    <label>Precio</label>
                    <input type="number" id="productoPrecio" step="0.01" required>
                </div>
                <div class="form-group">
                    <label>Stock</label>
                    <input type="number" id="productoStock" required>
                </div>
                <div class="form-group">
                    <label>Categor√≠a</label>
                    <input type="text" id="productoCategoria" required>
                </div>
                <button type="submit" class="btn btn-primary">Guardar</button>
            </form>
        </div>
    </div>

    <!-- Modal Detalle Venta -->
    <div id="modalDetalleVenta" class="modal">
        <div class="modal-content">
            <span class="close" onclick="cerrarModalDetalle()">&times;</span>
            <div id="detalleVentaContent"></div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:3000/api';
        let carrito = [];
        let productos = [];

        // Navegaci√≥n entre tabs
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            if (tabName === 'dashboard') cargarDashboard();
            if (tabName === 'venta') cargarProductosVenta();
            if (tabName === 'productos') cargarProductos();
            if (tabName === 'historial') cargarHistorial();
        }

        // Dashboard
        async function cargarDashboard() {
            const res = await fetch(`${API_URL}/dashboard`);
            const data = await res.json();

            document.getElementById('totalVentas').textContent = `$${data.totalVentas.toLocaleString()}`;
            document.getElementById('ventasHoy').textContent = data.ventasHoy;
            document.getElementById('promedioVenta').textContent = `$${data.promedioVenta.toLocaleString()}`;
            document.getElementById('totalProductos').textContent = data.totalProductos;

            const tbody1 = document.querySelector('#topProductos tbody');
            tbody1.innerHTML = data.topProductos.map(p => `
                <tr>
                    <td>${p.nombre}</td>
                    <td>${p.cantidadTotal}</td>
                    <td>$${p.precio.toLocaleString()}</td>
                </tr>
            `).join('');

            const tbody2 = document.querySelector('#stockBajo tbody');
            tbody2.innerHTML = data.stockBajo.map(p => `
                <tr>
                    <td>${p.nombre} <span class="badge badge-danger">Stock Bajo</span></td>
                    <td>${p.stock}</td>
                    <td>$${p.precio.toLocaleString()}</td>
                </tr>
            `).join('');
        }

        // Productos para venta
        async function cargarProductosVenta() {
            const res = await fetch(`${API_URL}/productos`);
            productos = await res.json();
            mostrarProductosVenta(productos);
        }

        function mostrarProductosVenta(prods) {
            const lista = document.getElementById('listaProductosVenta');
            lista.innerHTML = prods.map(p => `
                <div class="producto-item">
                    <div>
                        <strong>${p.nombre}</strong><br>
                        <small>Stock: ${p.stock} | $${p.precio.toLocaleString()}</small>
                    </div>
                    <button class="btn btn-primary" onclick="agregarAlCarrito(${p.id})" ${p.stock === 0 ? 'disabled' : ''}>
                        ${p.stock === 0 ? 'Sin Stock' : '‚ûï Agregar'}
                    </button>
                </div>
            `).join('');
        }

        document.getElementById('buscarProducto').addEventListener('input', (e) => {
            const texto = e.target.value.toLowerCase();
            const filtrados = productos.filter(p => p.nombre.toLowerCase().includes(texto));
            mostrarProductosVenta(filtrados);
        });

        function agregarAlCarrito(id) {
            const producto = productos.find(p => p.id === id);
            const itemCarrito = carrito.find(i => i.id === id);

            if (itemCarrito) {
                if (itemCarrito.cantidad < producto.stock) {
                    itemCarrito.cantidad++;
                } else {
                    alert('No hay suficiente stock');
                    return;
                }
            } else {
                carrito.push({ ...producto, cantidad: 1 });
            }
            actualizarCarrito();
        }

        function actualizarCarrito() {
            const carritoItems = document.getElementById('carritoItems');
            carritoItems.innerHTML = carrito.map(item => `
                <div class="carrito-item">
                    <div>
                        <strong>${item.nombre}</strong><br>
                        <small>$${item.precio} x ${item.cantidad}</small>
                    </div>
                    <div>
                        <button class="btn btn-warning" style="padding: 5px 10px; margin-right: 5px;" onclick="cambiarCantidad(${item.id}, -1)">-</button>
                        <button class="btn btn-warning" style="padding: 5px 10px; margin-right: 5px;" onclick="cambiarCantidad(${item.id}, 1)">+</button>
                        <button class="btn btn-danger" style="padding: 5px 10px;" onclick="eliminarDelCarrito(${item.id})">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');

            const total = carrito.reduce((sum, item) => sum + (item.precio * item.cantidad), 0);
            document.getElementById('totalCarrito').textContent = total.toLocaleString();
        }

        function cambiarCantidad(id, delta) {
            const item = carrito.find(i => i.id === id);
            const producto = productos.find(p => p.id === id);
            
            if (item.cantidad + delta > producto.stock) {
                alert('No hay suficiente stock');
                return;
            }
            
            if (item.cantidad + delta <= 0) {
                eliminarDelCarrito(id);
                return;
            }
            
            item.cantidad += delta;
            actualizarCarrito();
        }

        function eliminarDelCarrito(id) {
            carrito = carrito.filter(i => i.id !== id);
            actualizarCarrito();
        }

        function limpiarCarrito() {
            carrito = [];
            actualizarCarrito();
        }

        async function procesarVenta() {
            if (carrito.length === 0) {
                alert('El carrito est√° vac√≠o');
                return;
            }

            const total = carrito.reduce((sum, item) => sum + (item.precio * item.cantidad), 0);
            const metodoPago = document.getElementById('metodoPago').value;

            const venta = {
                items: carrito.map(item => ({
                    id: item.id,
                    nombre: item.nombre,
                    precio: item.precio,
                    cantidad: item.cantidad,
                    subtotal: item.precio * item.cantidad
                })),
                total,
                metodoPago
            };

            try {
                const res = await fetch(`${API_URL}/ventas`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(venta)
                });

                if (res.ok) {
                    const data = await res.json();
                    alert(`‚úÖ Venta procesada exitosamente!\nFactura: ${data.numeroFactura}\nTotal: ${data.total.toLocaleString()}`);
                    limpiarCarrito();
                    cargarProductosVenta();
                } else {
                    const error = await res.json();
                    alert(`‚ùå Error: ${error.error}`);
                }
            } catch (error) {
                alert('Error al procesar la venta');
            }
        }

        // Gesti√≥n de Productos
        async function cargarProductos() {
            const res = await fetch(`${API_URL}/productos`);
            productos = await res.json();
            
            const tbody = document.querySelector('#tablaProductos tbody');
            tbody.innerHTML = productos.map(p => `
                <tr>
                    <td>${p.id}</td>
                    <td>${p.nombre}</td>
                    <td>${p.precio.toLocaleString()}</td>
                    <td>${p.stock} ${p.stock < 20 ? '<span class="badge badge-danger">Bajo</span>' : ''}</td>
                    <td>${p.categoria}</td>
                    <td>
                        <button class="btn btn-primary" style="padding: 5px 10px; margin-right: 5px;" onclick="editarProducto(${p.id})">‚úèÔ∏è</button>
                        <button class="btn btn-danger" style="padding: 5px 10px;" onclick="eliminarProducto(${p.id})">üóëÔ∏è</button>
                    </td>
                </tr>
            `).join('');
        }

        function mostrarModalProducto() {
            document.getElementById('modalProducto').style.display = 'block';
            document.getElementById('tituloModal').textContent = 'Nuevo Producto';
            document.getElementById('formProducto').reset();
            document.getElementById('productoId').value = '';
        }

        function cerrarModalProducto() {
            document.getElementById('modalProducto').style.display = 'none';
        }

        async function editarProducto(id) {
            const producto = productos.find(p => p.id === id);
            document.getElementById('modalProducto').style.display = 'block';
            document.getElementById('tituloModal').textContent = 'Editar Producto';
            document.getElementById('productoId').value = producto.id;
            document.getElementById('productoNombre').value = producto.nombre;
            document.getElementById('productoPrecio').value = producto.precio;
            document.getElementById('productoStock').value = producto.stock;
            document.getElementById('productoCategoria').value = producto.categoria;
        }

        async function guardarProducto(e) {
            e.preventDefault();
            
            const id = document.getElementById('productoId').value;
            const producto = {
                nombre: document.getElementById('productoNombre').value,
                precio: parseFloat(document.getElementById('productoPrecio').value),
                stock: parseInt(document.getElementById('productoStock').value),
                categoria: document.getElementById('productoCategoria').value
            };

            try {
                let res;
                if (id) {
                    res = await fetch(`${API_URL}/productos/${id}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(producto)
                    });
                } else {
                    res = await fetch(`${API_URL}/productos`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(producto)
                    });
                }

                if (res.ok) {
                    alert('‚úÖ Producto guardado exitosamente');
                    cerrarModalProducto();
                    cargarProductos();
                }
            } catch (error) {
                alert('Error al guardar el producto');
            }
        }

        async function eliminarProducto(id) {
            if (!confirm('¬øEst√°s seguro de eliminar este producto?')) return;

            try {
                const res = await fetch(`${API_URL}/productos/${id}`, {
                    method: 'DELETE'
                });

                if (res.ok) {
                    alert('‚úÖ Producto eliminado');
                    cargarProductos();
                }
            } catch (error) {
                alert('Error al eliminar el producto');
            }
        }

        // Historial de Ventas
        async function cargarHistorial() {
            const res = await fetch(`${API_URL}/ventas`);
            const ventas = await res.json();
            
            const tbody = document.querySelector('#tablaHistorial tbody');
            tbody.innerHTML = ventas.reverse().map(v => `
                <tr>
                    <td><strong>${v.numeroFactura}</strong></td>
                    <td>${new Date(v.fecha).toLocaleString('es-CO')}</td>
                    <td>${v.items.length} productos</td>
                    <td><strong>${v.total.toLocaleString()}</strong></td>
                    <td>${v.metodoPago}</td>
                    <td>
                        <button class="btn btn-primary" style="padding: 5px 10px;" onclick="verDetalleVenta(${v.id})">üëÅÔ∏è Ver</button>
                    </td>
                </tr>
            `).join('');
        }

        async function verDetalleVenta(id) {
    try {
        console.log('=== INICIANDO CARGA DE VENTA ===');
        console.log('ID:', id);
        
        const res = await fetch(`${API_URL}/ventas/${id}`);
        
        if (!res.ok) {
            throw new Error(`Error HTTP: ${res.status}`);
        }
        
        const venta = await res.json();
        
        console.log('=== VENTA RECIBIDA ===');
        console.log(JSON.stringify(venta, null, 2));

        if (!venta) {
            throw new Error('No se recibi√≥ informaci√≥n de la venta');
        }

        if (!venta.items || !Array.isArray(venta.items)) {
            console.error('Items no v√°lidos:', venta.items);
            throw new Error('La venta no tiene items v√°lidos');
        }

        // Procesar items con m√°xima seguridad
        let itemsHTML = '';
        for (let i = 0; i < venta.items.length; i++) {
            const item = venta.items[i];
            console.log(`Item ${i}:`, item);
            
            const nombre = item.nombre || item.nombre_producto || 'Producto sin nombre';
            const cantidad = parseInt(item.cantidad) || 0;
            const precio = parseFloat(item.precio || item.precio_unitario || 0);
            const subtotal = parseFloat(item.subtotal || (precio * cantidad) || 0);
            
            itemsHTML += `
                <tr>
                    <td>${nombre}</td>
                    <td>${cantidad}</td>
                    <td>$${precio.toLocaleString('es-CO')}</td>
                    <td>$${subtotal.toLocaleString('es-CO')}</td>
                </tr>
            `;
        }

        const numeroFactura = venta.numeroFactura || venta.numero_factura || 'Sin n√∫mero';
        const metodoPago = venta.metodoPago || venta.metodo_pago || 'No especificado';
        const subtotalVenta = parseFloat(venta.subtotal || 0);
        const ivaVenta = parseFloat(venta.iva || 0);
        const totalVenta = parseFloat(venta.total || 0);

        const content = `
            <h2>üìÑ Factura ${numeroFactura}</h2>
            <p><strong>Fecha:</strong> ${new Date(venta.fecha).toLocaleString('es-CO')}</p>
            <p><strong>M√©todo de Pago:</strong> ${metodoPago}</p>
            <hr>
            <h3>Productos:</h3>
            <table style="width: 100%;">
                <thead>
                    <tr>
                        <th>Producto</th>
                        <th>Cant.</th>
                        <th>Precio</th>
                        <th>Subtotal</th>
                    </tr>
                </thead>
                <tbody>
                    ${itemsHTML}
                </tbody>
            </table>
            <hr>
            <p><strong>Subtotal:</strong> $${subtotalVenta.toLocaleString('es-CO')}</p>
            <p><strong>IVA (19%):</strong> $${ivaVenta.toLocaleString('es-CO')}</p>
            <h3 style="color: #667eea;">Total: $${totalVenta.toLocaleString('es-CO')}</h3>
        `;

        const modalContent = document.getElementById('detalleVentaContent');
        const modal = document.getElementById('modalDetalleVenta');
        
        if (!modalContent) {
            throw new Error('No se encontr√≥ el elemento detalleVentaContent');
        }
        if (!modal) {
            throw new Error('No se encontr√≥ el elemento modalDetalleVenta');
        }

        modalContent.innerHTML = content;
        modal.style.display = 'block';
        
        console.log('=== MODAL MOSTRADO EXITOSAMENTE ===');
    } catch (error) {
        console.error('=== ERROR AL CARGAR VENTA ===');
        console.error('Tipo:', error.name);
        console.error('Mensaje:', error.message);
        console.error('Stack:', error.stack);
        alert('‚ùå Error al cargar los detalles de la venta:\n' + error.message);
    }
}

        // Cerrar modales al hacer clic fuera
        window.onclick = function(event) {
            const modalProducto = document.getElementById('modalProducto');
            const modalDetalle = document.getElementById('modalDetalleVenta');
            
            if (event.target === modalProducto) {
                modalProducto.style.display = 'none';
            }
            if (event.target === modalDetalle) {
                modalDetalle.style.display = 'none';
            }
        }

        // Cargar dashboard al iniciar
        cargarDashboard();
        
        // Hacer funciones globales para que sean accesibles desde onclick
        window.showTab = showTab;
        window.agregarAlCarrito = agregarAlCarrito;
        window.cambiarCantidad = cambiarCantidad;
        window.eliminarDelCarrito = eliminarDelCarrito;
        window.limpiarCarrito = limpiarCarrito;
        window.procesarVenta = procesarVenta;
        window.mostrarModalProducto = mostrarModalProducto;
        window.cerrarModalProducto = cerrarModalProducto;
        window.editarProducto = editarProducto;
        window.guardarProducto = guardarProducto;
        window.eliminarProducto = eliminarProducto;
        window.verDetalleVenta = verDetalleVenta;
        window.cerrarModalDetalle = cerrarModalDetalle;
        
        // Test: verificar que las funciones est√°n disponibles
        console.log('Funciones disponibles:');
        console.log('- verDetalleVenta:', typeof window.verDetalleVenta);
        console.log('- cerrarModalDetalle:', typeof window.cerrarModalDetalle);
    </script>
</body>
</html>